#!/usr/bin/env ruby
# dehashrocketify

# 20171123
# 0.3.0

# Changes since 0.2:
# 1. Added support for .erb and .rabl files.
# 2. Outputs the file under consideration.

def input_filenames
  if ARGV[0]
    if File.directory?(ARGV[0])
      Dir.glob("#{ARGV[0]}/**/*.{erb,rb,rabl}")
    else
      Dir[ARGV[0]]
    end
  else
    Dir['*.{erb,rb,rabl}']
  end
end

def ruby_filenames
  input_filenames.reject do |input_filename|
    File.directory?(input_filename)
  end
end

def main
  ruby_filenames.each do |ruby_filename|
    puts ruby_filename
    contents = File.read(ruby_filename)
    new_contents = contents.gsub(/([^\:])\:(\w+) *=>/, "\\1\\2:")
    File.write(ruby_filename, new_contents)
  end
end

main
